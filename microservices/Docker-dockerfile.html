<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="author" content="cencuansen">



<meta name="description" content="All About C# and JavaScript">


<meta name="keywords" content="JavaScript,csharp,c#,.NET,.NET Core,MySQL">


<title>
  cencuansen&#39;s blogs
</title>



<link rel="icon" href="/image/avatar-main.jpeg">




<!-- stylesheets list from _config.yml -->

<link rel="stylesheet" href="/css/style.css">

<link rel="stylesheet" href="/css/codeOps.css">




<!-- scripts list from _config.yml -->

<script src="/js/script.js"></script>

<script src="/js/tocbot.min.js"></script>

<script src="/js/clipboard.js"></script>

<script src="/js/codeOps.js"></script>









<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="cencuansen's blogs" type="application/atom+xml">
</head>

<body>
  <script>
    // this function is used to check current theme before page loaded.
    (() => {
      const currentTheme = window.localStorage && window.localStorage.getItem('theme') || 'dark';
      const isDark = currentTheme === 'dark';
      const pagebody = document.getElementsByTagName('body')[0]
      const mobileToggleTheme = document.getElementById("mobile-toggle-theme");
      if (isDark) {
        pagebody.classList.add('dark-theme');
        // mobile
        mobileToggleTheme && (document.getElementById("mobile-toggle-theme").innerText = "ğŸŒ™");
      } else {
        pagebody.classList.remove('dark-theme');
        // mobile
        mobileToggleTheme && (document.getElementById("mobile-toggle-theme").innerText = "â˜€ï¸");
      }
    })();
  </script>

  <div class="wrapper">
    <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        
        <a href="/">é¦–é¡µ</a>
        
      </div>
      <div class="menu navbar-right">
        
        <a class="menu-item" href="/categories">
          åˆ†ç±»
        </a>
        
        <a class="menu-item" href="/tags">
          æ ‡ç­¾
        </a>
        
        <input id="switch_default" type="checkbox" checked class="switch_default">
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">é¦–é¡µ</a>
          <a id="mobile-toggle-theme">â˜€ï¸</a>
        </div>
        <div class="menu-toggle" onclick="mobileBtn()">&#9776; èœå•</div>
      </div>
      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/categories">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tags">æ ‡ç­¾</a>
        
      </div>
    </div>
  </nav>

</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active")
      mobileMenu.classList.remove("active")
    } else {
      toggleMenu.classList.add("active")
      mobileMenu.classList.add("active")
    }
  }
</script>
    <div class="main">
      
<div class="container">
  
  
  <div class="post-toc">
  <div class="tocbot-list"></div>
  <div class="tocbot-list-menu">
    <!-- <a class="tocbot-toc-expand" onclick="expand_toc()">+ å±•å¼€</a> -->
    <a onclick="go_top()">â†‘ é¡¶éƒ¨</a>
    <a onclick="go_bottom()">â†“ åº•éƒ¨</a>
  </div>
</div>

<script>
  // tocbot: https://github.com/tscanlin/tocbot`
  var tocbot_timer;
  var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
  var tocbot_default_config = {
    // Where to render the table of contents.
    tocSelector: '.tocbot-list',
    // // Where to grab the headings to build the table of contents.
    contentSelector: '.post-content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    // 0: collapse them all; 6: expand all
    collapseDepth: 6,
    orderedList: false,
    scrollSmooth: true,
    isCollapsedClass: 'is-collapsed',
    onClick: () => {} // extend_click,
  };

  function extend_click() {
    clearTimeout(tocbot_timer);
    tocbot_timer = setTimeout(function() {
      tocbot.refresh(obj_merge(tocbot_default_config, {
        hasInnerContainers: false
      }));
    }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
  }

  document.ready(function() {
    tocbot.init(obj_merge(tocbot_default_config));
  });

  function expand_toc() {
    var expandButton = document.querySelector('.tocbot-toc-expand');
    var expanded = expandButton.getAttribute('data-expanded');
    expanded ? expandButton.removeAttribute('data-expanded') : expandButton.setAttribute('data-expanded', true);
    // tocbot.refresh(obj_merge(tocbot_default_config, {
    //   collapseDepth: expanded ? 0 : DEPTH_MAX
    // }));
    expandButton.innerText = expanded ? '+ å±•å¼€' : 'Ã— å…³é—­';
  }

  function go_top() {
    window.scrollTo(0, 0);
  }

  function go_bottom() {
    window.scrollTo(0, document.body.scrollHeight);
  }

  function obj_merge(target, source) {
    for (var item in source) {
      if (source.hasOwnProperty(item)) {
        target[item] = source[item];
      }
    }
    return target;
  }
</script>
  

  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">
        Docker dockerfile
      </h1>
      
      <div class="post-meta">
        

        
        <span class="post-time">
          æ—¥æœŸï¼š<a href="#">
            2023å¹´ 02æœˆ
            <!-- &nbsp;&nbsp;18:32:48 -->
          </a>
        </span>
        
        
        <span class="post-category">
          &nbsp;&nbsp;
          åˆ†ç±»ï¼š
          <a href="/categories/Docker/">Docker</a>
          
        </span>
        
      </div>
      
      <section class="post-tags">
        <div style="text-align: left;">
          <span>æ ‡ç­¾ï¼š</span>
          <span class="tag" style>
            
            
            <a href="/tags/Docker/"># Docker</a>
            
            
          </span>
        </div>
        <div style="text-align: right; min-width: 50px;">
          <a href="javascript:window.history.back();"> â† è¿”å›</a>
          <!-- <span>&nbsp;|&nbsp;</span>
          <a href="/">è¿”å›ä¸»é¡µ</a> -->
        </div>
      </section>
    </header>

    <div class="post-content">
      <h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install emacs</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install apache2</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><code>FROM debian</code>ï¼šå°† debian é•œåƒä½œä¸ºåŸºç¡€é•œåƒ<br><code>RUN apt-get install emacs</code>ï¼šå®‰è£… emacs<br><code>RUN apt-get install apache2</code>ï¼šå®‰è£… apache2<br><code>CMD [&quot;/bin/bash&quot;]</code>ï¼šæ‰§è¡Œ bash</p>
<h1 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h1><p>FROM ç”¨æ¥åˆå§‹åŒ–æ–°çš„ç”Ÿæˆé˜¶æ®µï¼Œå¹¶ä¸ºåç»­æŒ‡ä»¤æä¾›åŸºæœ¬æ˜ åƒã€‚<br>å¤šä¸ª FROM ä»£è¡¨<code>å¤šé˜¶æ®µ</code>æ„å»ºã€‚<br>Dockerfile ä¸€èˆ¬ä»¥ FROM å¼€å¤´ï¼ŒARG æ˜¯å”¯ä¸€èƒ½åœ¨ FROM ä¹‹å‰çš„æŒ‡ä»¤ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span>  CODE_VERSION=latest</span><br><span class="line"><span class="keyword">FROM</span> base:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">  /code/run-app</span></span><br></pre></td></tr></table></figure>

<h1 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h1><ol>
<li>shell æ¨¡å¼ï¼šRUN <command></li>
<li>exec æ¨¡å¼ï¼šRUN [â€œexecutableâ€, â€œparam1â€, â€œparam2â€]</li>
</ol>
<p>RUN ä¼šåˆ›å»ºæ–°çš„å±‚ï¼ˆLayerï¼‰ï¼Œåœ¨æ–°çš„å±‚ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶æäº¤ï¼ˆcommitï¼‰æ‰§è¡Œç»“æœã€‚<br>shell æ¨¡å¼ä¼šè°ƒç”¨ shellï¼Œexec æ¨¡å¼ä¸ä¼šè°ƒç”¨ shellã€‚<br>exec æ¨¡å¼é»˜è®¤ä¸ä¼šè¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢ï¼ˆæŒ‡çš„æ˜¯å˜é‡æ›¿æ¢ï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡æ˜¾å¼è°ƒç”¨ shell çš„å½¢å¼å¤„ç†ï¼š</p>
<p>exec æ¨¡å¼è°ƒç”¨ shellï¼Œ$HOME ä¸ºå˜é‡ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo <span class="variable">$HOME</span>&quot;</span> ]</span></span><br></pre></td></tr></table></figure>

<h1 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h1><ol>
<li>exec æ¨¡å¼ï¼Œé¦–é€‰ï¼šCMD [â€œexecutableâ€,â€param1â€,â€param2â€]</li>
<li>ä¸º ENTRYPOINT æä¾›é»˜è®¤å‚æ•°å½¢å¼ï¼šCMD [â€œparam1â€,â€param2â€]</li>
<li>shell æ¨¡å¼ï¼šCMD command param1 param2</li>
</ol>
<p>ä¸€ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ª CMDï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œä¹Ÿåªæœ‰æœ€åä¸€ä¸ªæœ‰æ•ˆã€‚<br>CMD ä¸»è¦ç”¨é€”æ˜¯ç»™æ‰§è¡Œå®¹å™¨é»˜è®¤è¡Œä¸ºï¼Œå¦‚ï¼šæŒ‡å®šé»˜è®¤æ‰§è¡Œæ–‡ä»¶ã€‚<br>å¦‚æœ CMD ç”¨çš„ç¬¬ 2 ä¸­æ¨¡å¼ï¼ˆä¸º ENTRYPOINT æä¾›é»˜è®¤å‚æ•°å½¢å¼ï¼‰ï¼Œé‚£ä¹ˆ ENTRYPOINT æŒ‡ä»¤ä¹Ÿåº”è¯¥ç”¨å­—ç¬¦ä¸²æ•°ç»„çš„å½¢å¼ï¼ŒCMD çš„å€¼å°±ä¼šæ˜¯ ENTRYPOINT é»˜è®¤å‚æ•°ã€‚<br>ä¸è¦å°† RUN ä¸ CMD æ··æ·†ã€‚RUN å®é™…ä¸Šè¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶æäº¤ç»“æœï¼›CMD åœ¨æ„å»ºæ—¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œè€Œæ˜¯ä¸ºé•œåƒæå‰è®¾ç½®æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>
<h1 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h1><p>å£°æ˜å“ªäº›ç«¯å£æ˜¯å°†è¦å¼€æ”¾çš„ï¼Œdocker run æ—¶ ä½¿ç”¨ -Pï¼ˆP æ˜¯å¤§å†™çš„ï¼‰è¿›è¡Œéšæœºç«¯å£å…³è”æ˜ å°„ã€‚æˆ–è€…ä½¿ç”¨<br>docker run -p å¤–éƒ¨ç«¯å£:å®¹å™¨ç«¯å£ é•œåƒåã€‚æ‰€ä»¥ Dockerfile ä¸­ä½¿ç”¨ EXPOSE ç”¨å¤„ä¸å¤§ã€‚</p>
<h1 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h1><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¼šè¢«æŒä¹…åŒ–è¿›å®¹å™¨ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MY_NAME=<span class="string">&quot;John Doe&quot;</span>  MY_DOG=<span class="string">&quot;Rex The Dog&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> MY_VAR my-value</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸å¸Œæœ› ENV ç¯å¢ƒå˜é‡æŒä¹…åŒ–è¿›å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨è¡Œå†…å˜é‡ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y ...</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ DEBIAN_FRONTEND&#x3D;noninteractive å°±æ˜¯è¡Œå†…å˜é‡ã€‚<br>æˆ–è€… ARG æŒ‡ä»¤ä¹Ÿèƒ½å®ç°ä¸æŒä¹…åŒ–å˜é‡åˆ°å®¹å™¨ã€‚</p>
<h1 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] [--checksum=&lt;checksum&gt;] &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;src&gt;&quot;</span>,... <span class="string">&quot;&lt;dest&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>â€“chown åªæ”¯æŒ Linux å®¹å™¨ã€‚<br>ADD ä½œç”¨æ˜¯ï¼šä» src å¤åˆ¶æ–‡ä»¶åˆ°é•œåƒä¸­ dest è·¯å¾„ï¼Œä¼šåˆ›å»ºæ–°çš„å±‚ã€‚<br>src å¯ä»¥æ˜¯ï¼šæœ¬åœ°æ–‡ä»¶ã€ç›®å½•ã€url å½¢å¼çš„è¿œç¨‹æ–‡ä»¶ã€‚<br>å¦‚æœ src æ˜¯æœ¬åœ°çš„å‹ç¼©æ–‡ä»¶ï¼ˆ.tar.xzï¼‰ï¼ŒADD ä¼šè‡ªåŠ¨è§£å‹åˆ°é•œåƒä¸­ã€‚<br>å¤š src çš„ï¼Œè·¯å¾„è¢«è§£æä¸ºç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äº build è·¯å¾„ï¼‰ã€‚<br>src å¯ä»¥åŒ…å«é€šé…ç¬¦ï¼š* å¤šå­—ç¬¦ï¼Œ? å•å­—ç¬¦ã€‚</p>
<h1 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;src&gt;&quot;</span>,... <span class="string">&quot;&lt;dest&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>COPY åŠŸèƒ½å’Œ ADD ç±»ä¼¼ï¼ŒåŒæ ·ä¼šåˆ›å»ºæ–°çš„å±‚ã€‚<br>src å¯ä»¥æ˜¯ï¼šæœ¬åœ°æ–‡ä»¶ã€ç›®å½•ã€‚<br>ADD å’Œ COPY ä¸¤è€…ï¼Œæ›´æ¨èä½¿ç”¨ COPYã€‚</p>
<h1 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h1><p>Dockerfile ä¸­ WORKDIR æŒ‡ä»¤ä¸ºåç»­çš„ RUNã€CMDã€ENTRYPOINTã€COPYã€ADD ç­‰æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚<br>å¤š WORKDIR æŒ‡ä»¤ï¼Œå¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„ï¼Œåˆ™åå‡ºç°çš„ WORKDIR æ˜¯åŸºäºå…ˆå‰å‡ºç°çš„ WORKDIR çš„è·¯å¾„çš„ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> c</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<h1 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h1><ol>
<li>exec æ¨¡å¼ï¼šENTRYPOINT [â€œexecutableâ€, â€œparam1â€, â€œparam2â€]</li>
<li>shell æ¨¡å¼ï¼šENTRYPOINT command param1 param2</li>
</ol>
<p>docker run [image] [arguments] çš„ arguments éƒ¨åˆ†ä¼šè¿½åŠ åˆ° exec æ¨¡å¼çš„ ENTRYPOINT æŒ‡ä»¤æ•°ç»„çš„åé¢ï¼Œå¹¶ä¸”ä¼šæ›¿æ¢ CMD æŒ‡ä»¤ä¸­æ‰€æœ‰å…ƒç´ ã€‚å¦‚æœæƒ³æ›¿æ¢ ENTRYPOINTï¼Œä½¿ç”¨ docker run â€“entrypointã€‚<br>shell æ¨¡å¼çš„ ENTRYPOINT ä¼šé˜»æ­¢<br>Dockerfile ä¸­åªæœ‰æœ€åä¸€ä¸ª ENTRYPOINT æ˜¯æœ‰æ•ˆæŒ‡ä»¤ã€‚</p>
<h1 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h1><p>å‡è®¾ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šå…¬å¸çš„æœåŠ¡å™¨éœ€è¦å®šæœŸæ¸…ç†æ—§çš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><figcaption><span>clean_log æ–‡ä»¶</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å³å°†åˆ é™¤ <span class="variable">$1</span> å¤©å‰çš„æ—¥å¿—æ–‡ä»¶&quot;</span></span><br><span class="line">find /log_dir -ctime <span class="string">&quot;<span class="variable">$1</span>&quot;</span> -name <span class="string">&#x27;*log&#x27;</span> -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><figcaption><span>dockerfile æ–‡ä»¶</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">14.04</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† clean_log è„šæœ¬æ·»åŠ åˆ°é•œåƒä¸­</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> clean_log /usr/bin/clean_log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® clean_log å¯æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /usr/bin/clean_log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ­¤é•œåƒçš„å…¥å£ç‚¹å®šä¹‰ä¸º clean_log è„šæœ¬</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/usr/bin/clean_log&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸º ENTRYPOINT æä¾›é»˜è®¤å‚æ•°ï¼Œ7å¤©</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;7&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>æ„å»ºé•œåƒ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t log-cleaner .</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>è¿è¡Œé•œåƒ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /var/log/myapplogs:/log_dir log-cleaner 365</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°å‘½ä»¤å°† &#x2F;var&#x2F;log&#x2F;myapplogs ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„è„šæœ¬æŒ‡å®šçš„ç›®å½•ï¼Œå¹¶ä¸” 365 è¿™ä¸ªå€¼ä¼šæ›¿æ¢æ‰ CMD çš„ 7ã€‚</p>
<h1 id="RUNã€CMD-å’Œ-ENTRYPOINT"><a href="#RUNã€CMD-å’Œ-ENTRYPOINT" class="headerlink" title="RUNã€CMD å’Œ ENTRYPOINT"></a>RUNã€CMD å’Œ ENTRYPOINT</h1><p>Dockerfile ä¸­ RUNã€CMD å’Œ ENTRYPOINT éƒ½èƒ½å¤Ÿç”¨äºæ‰§è¡Œå‘½ä»¤ï¼Œä¸‹é¢æ˜¯ä¸‰è€…çš„ä¸»è¦ç”¨é€”ï¼š<br><code>RUN</code>ï¼šå‘½ä»¤æ‰§è¡Œå‘½ä»¤å¹¶åˆ›å»ºæ–°çš„é•œåƒå±‚ï¼Œé€šå¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…ï¼›<br><code>CMD</code>ï¼šå‘½ä»¤è®¾ç½®å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ï¼Œä½† CMD è®¾ç½®çš„å‘½ä»¤èƒ½å¤Ÿè¢« docker run å‘½ä»¤åé¢çš„å‘½ä»¤è¡Œå‚æ•°æ›¿æ¢ã€‚ä¸€ä¸ª Dockerfile è‡³å¤šåªèƒ½æœ‰ä¸€ä¸ª CMDï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚å¦‚æœæˆ‘ä»¬åœ¨ docker run æ—¶æŒ‡å®šäº†å‘½ä»¤æˆ–è€…æœ‰ ENTRYPOINTï¼Œé‚£ä¹ˆ CMD å°±ä¼šè¢«è¦†ç›–ï¼›<br><code>ENTRYPOINT</code>ï¼šé…ç½®å®¹å™¨å¯åŠ¨æ—¶çš„æ‰§è¡Œå‘½ä»¤ï¼Œä¸ä¼šè¢«å¿½ç•¥ï¼Œä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œå³ä½¿ docker run æ—¶æŒ‡å®šäº†å…¶ä»–å‘½ä»¤ã€‚å¦‚æœå­˜åœ¨å¤šä¸ª ENTRYPOINT å‘½ä»¤ï¼Œåˆ™åªä¼šæ‰§è¡Œæœ€åä¸€ä¸ª ENTRYPOINT å‘½ä»¤ã€‚</p>
<h2 id="RUN-1"><a href="#RUN-1" class="headerlink" title="RUN"></a>RUN</h2><figure class="highlight dockerfile"><figcaption><span>é”™è¯¯å†™æ³•</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:jessie</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y gcc libc6-dev make</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> wget -O redis.tar.gz <span class="string">&quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> -p /usr/src/redis</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> make -C /usr/src/redis</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> make -C /usr/src/redis install</span></span><br></pre></td></tr></table></figure>

<p>è¯¥å†™æ³•ä¼šåˆ›å»º 7 å±‚é•œåƒï¼Œè¿™æ˜¯å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„ï¼Œè€Œä¸”å¾ˆå¤šè¿è¡Œæ—¶ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œéƒ½è¢«è£…è¿›äº†é•œåƒé‡Œï¼Œæ¯”å¦‚ç¼–è¯‘ç¯å¢ƒã€æ›´æ–°çš„è½¯ä»¶åŒ…ç­‰ç­‰ã€‚ç»“æœå°±æ˜¯äº§ç”Ÿéå¸¸è‡ƒè‚¿ã€éå¸¸å¤šå±‚çš„é•œåƒï¼Œä¸ä»…ä»…å¢åŠ äº†æ„å»ºéƒ¨ç½²çš„æ—¶é—´ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ã€‚</p>
<figure class="highlight dockerfile"><figcaption><span>åˆç†å†™æ³•</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:jessie</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> buildDeps=<span class="string">&#x27;gcc libc6-dev make&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get install -y <span class="variable">$buildDeps</span> \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; wget -O redis.tar.gz <span class="string">&quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot;</span> \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; <span class="built_in">mkdir</span> -p /usr/src/redis \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; make -C /usr/src/redis \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; make -C /usr/src/redis install \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; <span class="built_in">rm</span> redis.tar.gz \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; <span class="built_in">rm</span> -r /usr/src/redis \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get purge -y --auto-remove <span class="variable">$buildDeps</span></span></span><br></pre></td></tr></table></figure>

<h2 id="CMD-1"><a href="#CMD-1" class="headerlink" title="CMD"></a>CMD</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">16.04</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get install -y curl \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-s&quot;</span>, <span class="string">&quot;http://ip.cn&quot;</span> ]</span></span><br></pre></td></tr></table></figure>

<p>è¯¥é•œåƒä½œç”¨æ˜¯æŸ¥æœºå™¨çš„ IPã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myip</span><br><span class="line">docker run myip</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³æ›¿æ¢ Dockerfile ä¸­ CMD ä¸­å‚æ•°ï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run myip curl -s http://ip.cn -i</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>RUNã€ADDã€COPY è¿™ä¸‰ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºæ–°çš„å±‚ã€‚</p>

    </div>

    

    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/microservices/RabbitMQ-basic-concepts">RabbitMQ åŸºç¡€</a>
      
      
      <a class="next" rel="next" href="/microservices/Docker-commands">Docker å¸¸ç”¨æŒ‡ä»¤</a>
      
    </section>
  </article>
</div>
    </div>
    <footer id="footer" class="footer">
  <div class="copyright">
    <span><a target="_blank" rel="noopener" href="https://github.com/cencuansen">cencuansen</a> & <a href="https://hexo.io" target="_blank">hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">chic</a> | <a href="/sitemap.xml">sitemap</a></span>
  </div>
</footer>
  </div>
</body>

</html>