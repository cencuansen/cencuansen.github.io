<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="author" content="San Huo">


<meta name="subtitle" content="çº¤å‡ç¿ è–‡å·…ï¼Œæ‰¶å…‰å…¥æ²§æ¸Šï¼Œæ‰¶æ‘‡æƒŠç ‚èµ·ï¼Œå±±å¼„æœ›èˆ’è¿œ">




<title>
  San Huo
</title>



<link rel="icon" href="/image/avatar-main.jpeg">




<!-- stylesheets list from _config.yml -->

<link rel="stylesheet" href="/css/style.css">




<!-- scripts list from _config.yml -->

<script src="/js/script.js"></script>

<script src="/js/tocbot.min.js"></script>









<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="San Huo" type="application/atom+xml">
</head>

<body>
  <script>
    // this function is used to check current theme before page loaded.
    (() => {
      const currentTheme = window.localStorage && window.localStorage.getItem('theme') || 'dark';
      const isDark = currentTheme === 'dark';
      const pagebody = document.getElementsByTagName('body')[0]
      const mobileToggleTheme = document.getElementById("mobile-toggle-theme");
      if (isDark) {
        pagebody.classList.add('dark-theme');
        // mobile
        mobileToggleTheme && (document.getElementById("mobile-toggle-theme").innerText = "ğŸŒ™");
      } else {
        pagebody.classList.remove('dark-theme');
        // mobile
        mobileToggleTheme && (document.getElementById("mobile-toggle-theme").innerText = "â˜€ï¸");
      }
    })();
  </script>

  <div class="wrapper">
    <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo"><a href="/">
          é¦–é¡µ
        </a></div>
      <div class="menu navbar-right">
        
        <a class="menu-item" href="/categories">
          åˆ†ç±»
        </a>
        
        <a class="menu-item" href="/tags">
          æ ‡ç­¾
        </a>
        
        <input id="switch_default" type="checkbox" checked class="switch_default">
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">é¦–é¡µ</a>
          <a id="mobile-toggle-theme">â˜€ï¸</a>
        </div>
        <div class="menu-toggle" onclick="mobileBtn()">&#9776; èœå•</div>
      </div>
      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/categories">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tags">æ ‡ç­¾</a>
        
      </div>
    </div>
  </nav>

</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active")
      mobileMenu.classList.remove("active")
    } else {
      toggleMenu.classList.add("active")
      mobileMenu.classList.add("active")
    }
  }
</script>
    <div class="main">
      
<div class="container">
  
  
  <div class="post-toc">
  <div class="tocbot-list"></div>
  <div class="tocbot-list-menu">
    <!-- <a class="tocbot-toc-expand" onclick="expand_toc()">+ å±•å¼€</a> -->
    <a onclick="go_top()">â†‘ é¡¶éƒ¨</a>
    <a onclick="go_bottom()">â†“ åº•éƒ¨</a>
  </div>
</div>

<script>
  // tocbot: https://github.com/tscanlin/tocbot
  var tocbot_timer;
  var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
  var tocbot_default_config = {
    // Where to render the table of contents.
    tocSelector: '.tocbot-list',
    // // Where to grab the headings to build the table of contents.
    contentSelector: '.post-content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    // 0: collapse them all; 6: expand all
    collapseDepth: 0,
    orderedList: false,
    scrollSmooth: true,
    isCollapsedClass: 'is-collapsed',
    onClick: () => {} // extend_click,
  };

  function extend_click() {
    clearTimeout(tocbot_timer);
    tocbot_timer = setTimeout(function() {
      tocbot.refresh(obj_merge(tocbot_default_config, {
        hasInnerContainers: false
      }));
    }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
  }

  document.ready(function() {
    tocbot.init(obj_merge(tocbot_default_config));
  });

  function expand_toc() {
    var expandButton = document.querySelector('.tocbot-toc-expand');
    var expanded = expandButton.getAttribute('data-expanded');
    expanded ? expandButton.removeAttribute('data-expanded') : expandButton.setAttribute('data-expanded', true);
    // tocbot.refresh(obj_merge(tocbot_default_config, {
    //   collapseDepth: expanded ? 0 : DEPTH_MAX
    // }));
    expandButton.innerText = expanded ? '+ å±•å¼€' : 'Ã— å…³é—­';
  }

  function go_top() {
    window.scrollTo(0, 0);
  }

  function go_bottom() {
    window.scrollTo(0, document.body.scrollHeight);
  }

  function obj_merge(target, source) {
    for (var item in source) {
      if (source.hasOwnProperty(item)) {
        target[item] = source[item];
      }
    }
    return target;
  }
</script>
  

  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">
        CSharp ç®€å•åº”ç”¨
      </h1>
      
      <div class="post-meta">
        

        
        <span class="post-time">
          æ—¥æœŸï¼š<a href="#">
            2023å¹´ 02æœˆ
            <!-- &nbsp;&nbsp;23:27:46 -->
          </a>
        </span>
        
        
        <span class="post-category">
          &nbsp;&nbsp;
          åˆ†ç±»ï¼š
          <a href="/categories/CSharp/">CSharp</a>
          
        </span>
        
      </div>
      
      <section class="post-tags">
        <div style="text-align: left;">
          <span>æ ‡ç­¾ï¼š</span>
          <span class="tag" style>
            
            
            <a href="/tags/CSharp/"># CSharp</a>
            
            
          </span>
        </div>
        <div style="text-align: right; min-width: 50px;">
          <a href="javascript:window.history.back();"> â† è¿”å›</a>
          <!-- <span>&nbsp;|&nbsp;</span>
          <a href="/">è¿”å›ä¸»é¡µ</a> -->
        </div>
      </section>
    </header>

    <div class="post-content">
      <h1 id="ç”ŸæˆäºŒç»´ç "><a href="#ç”ŸæˆäºŒç»´ç " class="headerlink" title="ç”ŸæˆäºŒç»´ç "></a>ç”ŸæˆäºŒç»´ç </h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Stream <span class="title">QRCodeStream</span>(<span class="params"><span class="built_in">string</span> contents</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    QRCodeGenerator qrGenerator = <span class="keyword">new</span> QRCodeGenerator();</span><br><span class="line">    QRCodeData qrCodeData = qrGenerator.CreateQrCode(contents, QRCodeGenerator.ECCLevel.L);</span><br><span class="line">    QRCode qrCode = <span class="keyword">new</span> QRCode(qrCodeData);</span><br><span class="line">    Bitmap bigMap = qrCode.GetGraphic(<span class="number">20</span>, Color.Black, Color.White, <span class="literal">true</span>);</span><br><span class="line">    MemoryStream stream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">    bigMap.Save(stream, System.Drawing.Imaging.ImageFormat.Png);</span><br><span class="line">    stream.Position = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> stream;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ‹¼æ¥å›¾ç‰‡"><a href="#æ‹¼æ¥å›¾ç‰‡" class="headerlink" title="æ‹¼æ¥å›¾ç‰‡"></a>æ‹¼æ¥å›¾ç‰‡</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> file1 = <span class="string">@&quot;C:\Users\Admin\Desktop\images\1.png&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> file2 = <span class="string">@&quot;C:\Users\Admin\Desktop\images\2.png&quot;</span>;</span><br><span class="line">Image image1 = Image.FromStream(<span class="keyword">new</span> MemoryStream(File.ReadAllBytes(file1)));</span><br><span class="line">Image image2 = Image.FromStream(<span class="keyword">new</span> MemoryStream(File.ReadAllBytes(file2)));</span><br><span class="line"><span class="keyword">var</span> image1Width = image1.Width;</span><br><span class="line"><span class="keyword">var</span> image1Height = image1.Height;</span><br><span class="line"><span class="keyword">var</span> image2Width = image2.Height;</span><br><span class="line"><span class="keyword">var</span> image2Height = image2.Height;</span><br><span class="line"><span class="keyword">var</span> stream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line"><span class="keyword">using</span> Bitmap map = <span class="keyword">new</span> Bitmap(image1Width, image1Height);<span class="comment">//å®šä¹‰ç”»å¸ƒ</span></span><br><span class="line">Graphics g = Graphics.FromImage(map);<span class="comment">//å®šä¹‰ç”»ç¬”</span></span><br><span class="line">g.Clear(Color.White);<span class="comment">//æŠŠç”»å¸ƒæ›´æ”¹ä¸ºç™½è‰²</span></span><br><span class="line">g.DrawImage(image1, <span class="keyword">new</span> Point(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">g.DrawImage(image2, <span class="keyword">new</span> Point(image1Width - image2Width, image1Height - image2Height));</span><br><span class="line">map.Save(stream, ImageFormat.Jpeg);</span><br></pre></td></tr></table></figure>

<h1 id="ç«¯å£å ç”¨æ£€æŸ¥"><a href="#ç«¯å£å ç”¨æ£€æŸ¥" class="headerlink" title="ç«¯å£å ç”¨æ£€æŸ¥"></a>ç«¯å£å ç”¨æ£€æŸ¥</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">&quot;è¯·è¾“å…¥éœ€è¦æ£€æµ‹çš„ç«¯å£å·(å¦‚ï¼š80), è¾“å…¥exité€€å‡ºæ­¤ç¨‹åº&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> inPortString = Console.ReadLine();</span><br><span class="line">  Process process = <span class="keyword">new</span> Process();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (inPortString == <span class="string">&quot;exit&quot;</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    process.Close();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> port = <span class="number">80</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrWhiteSpace(inPortString))</span><br><span class="line">    &#123;</span><br><span class="line">      Console.WriteLine(<span class="string">&quot;è¾“å…¥ç«¯å£å·éæ³•ï¼Œå°†æŸ¥è¯¢é»˜è®¤ç«¯å£å·ï¼š80&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      port = Convert.ToInt32(inPortString);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Exception e)</span><br><span class="line">  &#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;è¾“å…¥ç«¯å£å·éæ³•ï¼Œå°†æŸ¥è¯¢é»˜è®¤ç«¯å£å·ï¼š80&quot;</span>);</span><br><span class="line">    port = <span class="number">80</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process.StartInfo.FileName = <span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">  process.StartInfo.UseShellExecute = <span class="literal">false</span>;</span><br><span class="line">  process.StartInfo.RedirectStandardInput = <span class="literal">true</span>;</span><br><span class="line">  process.StartInfo.RedirectStandardOutput = <span class="literal">true</span>;</span><br><span class="line">  process.StartInfo.RedirectStandardError = <span class="literal">true</span>;</span><br><span class="line">  process.StartInfo.CreateNoWindow = <span class="literal">true</span>;</span><br><span class="line">  process.Start();</span><br><span class="line">  process.StandardInput.WriteLine(<span class="string">&quot;netstat -ano&quot;</span>);</span><br><span class="line">  process.StandardInput.WriteLine(<span class="string">&quot;exit&quot;</span>);</span><br><span class="line">  Regex reg = <span class="keyword">new</span> Regex(<span class="string">&quot;\\s+&quot;</span>, RegexOptions.Compiled);</span><br><span class="line">  <span class="built_in">bool</span> found = <span class="literal">false</span>;</span><br><span class="line">  <span class="built_in">string</span> line = <span class="built_in">string</span>.Empty;</span><br><span class="line">  <span class="keyword">while</span> ((line = process.StandardOutput.ReadLine()) != <span class="literal">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    line = line.Trim();</span><br><span class="line">    <span class="keyword">if</span> (line.StartsWith(<span class="string">&quot;TCP&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">    &#123;</span><br><span class="line">      line = reg.Replace(line, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="built_in">string</span>[] arr = line.Split(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (arr[<span class="number">1</span>].EndsWith(<span class="string">$&quot;:<span class="subst">&#123;port&#125;</span>&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        found = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">int</span> pid = <span class="built_in">int</span>.Parse(arr[<span class="number">4</span>]);</span><br><span class="line">        Process foundProcess = Process.GetProcessById(pid);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;port&#125;</span>ç«¯å£. pidï¼š<span class="subst">&#123;pid&#125;</span>, è¿›ç¨‹åï¼š<span class="subst">&#123;foundProcess.ProcessName&#125;</span>\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!found)</span><br><span class="line">  &#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;æœªæ‰¾åˆ°<span class="subst">&#123;port&#125;</span>ç«¯å£ä¸Šçš„è¿›ç¨‹\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  process.Close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="byte-ã€stringã€stream-é—´è½¬æ¢"><a href="#byte-ã€stringã€stream-é—´è½¬æ¢" class="headerlink" title="byte[]ã€stringã€stream é—´è½¬æ¢"></a>byte[]ã€stringã€stream é—´è½¬æ¢</h1><h2 id="stream-gt-string"><a href="#stream-gt-string" class="headerlink" title="stream -&gt; string"></a>stream -&gt; string</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StreamReader reader = <span class="keyword">new</span> StreamReader(stream);</span><br><span class="line"><span class="built_in">string</span> result = reader.ReadToEnd();</span><br></pre></td></tr></table></figure>

<h2 id="string-gt-stream"><a href="#string-gt-stream" class="headerlink" title="string -&gt; stream"></a>string -&gt; stream</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> test = <span class="string">&quot;This is string&quot;</span>;</span><br><span class="line"><span class="keyword">using</span> MemoryStream stream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line"><span class="keyword">using</span> StreamWriter writer = <span class="keyword">new</span> StreamWriter( stream );</span><br><span class="line">writer.Write( test );</span><br><span class="line">writer.Flush();</span><br></pre></td></tr></table></figure>

<h2 id="byte-gt-string"><a href="#byte-gt-string" class="headerlink" title="byte[] -&gt; string"></a>byte[] -&gt; string</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> str = System.Text.Encoding.Default.GetString( byteArray );</span><br></pre></td></tr></table></figure>

<h2 id="string-gt-byte"><a href="#string-gt-byte" class="headerlink" title="string -&gt; byte[]"></a>string -&gt; byte[]</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">byte</span>[] byteArray = System.Text.Encoding.Default.GetBytes( str );</span><br></pre></td></tr></table></figure>

<h2 id="stream-gt-byte"><a href="#stream-gt-byte" class="headerlink" title="stream -&gt; byte[]"></a>stream -&gt; byte[]</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">byte</span>[] bytes = <span class="keyword">new</span> <span class="built_in">byte</span>[stream.Length];</span><br><span class="line">stream.Read(bytes, <span class="number">0</span>, bytes.Length);</span><br></pre></td></tr></table></figure>

<h2 id="byte-gt-stream"><a href="#byte-gt-stream" class="headerlink" title="byte[] -&gt; stream"></a>byte[] -&gt; stream</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Stream stream = <span class="keyword">new</span> MemoryStream(bytes);</span><br></pre></td></tr></table></figure>

<h1 id="æ–‡æœ¬é•¿åº¦"><a href="#æ–‡æœ¬é•¿åº¦" class="headerlink" title="æ–‡æœ¬é•¿åº¦"></a>æ–‡æœ¬é•¿åº¦</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> strTmp = <span class="string">&quot;a1æŸæŸæŸ&quot;</span>;</span><br><span class="line"><span class="comment">// 10ï¼ŒUnicodeä¸‹ä¸­è‹±æ–‡æ¯ä¸ªå­—2å­—èŠ‚ã€‚</span></span><br><span class="line"><span class="built_in">int</span> len1 = System.Text.Encoding.Unicode.GetBytes(strTmp).Length;</span><br><span class="line"><span class="comment">// 11ï¼ŒDefault ç­‰ä»·ä¸ UTF8ï¼Œä¸­æ–‡3ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡1ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="built_in">int</span> len2 = System.Text.Encoding.Default.GetBytes(strTmp).Length;</span><br><span class="line"><span class="built_in">int</span> len3 = System.Text.Encoding.UTF8.GetBytes(strTmp).Length;</span><br><span class="line"><span class="comment">// 5ï¼Œå°±æ˜¯ä¸ªæ•°</span></span><br><span class="line"><span class="built_in">int</span> len4 = System.Text.Encoding.Default.GetBytes(strTmp).Length;</span><br></pre></td></tr></table></figure>

<h1 id="WebSocket-åº”ç”¨"><a href="#WebSocket-åº”ç”¨" class="headerlink" title="WebSocket åº”ç”¨"></a>WebSocket åº”ç”¨</h1><h2 id="Startup-Configure"><a href="#Startup-Configure" class="headerlink" title="Startup.Configure"></a>Startup.Configure</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseWebSockets();</span><br></pre></td></tr></table></figure>

<h2 id="Controller-cs"><a href="#Controller-cs" class="headerlink" title="Controller.cs"></a>Controller.cs</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;receive-message&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">GetMessage</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (HttpContext.WebSockets.IsWebSocketRequest)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> webSocket = <span class="keyword">await</span> HttpContext.WebSockets.AcceptWebSocketAsync())</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;WebSocket connection established&quot;</span>);</span><br><span class="line">            <span class="keyword">await</span> Echo(webSocket);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        HttpContext.Response.StatusCode = <span class="number">400</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">Echo</span>(<span class="params">WebSocket webSocket</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">1024</span> * <span class="number">4</span>];</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> webSocket.ReceiveAsync(<span class="keyword">new</span> ArraySegment&lt;<span class="built_in">byte</span>&gt;(buffer), CancellationToken.None);</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Message received from Client&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (!result.CloseStatus.HasValue)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> serverMsg = Encoding.UTF8.GetBytes(<span class="string">$&quot;Server: Hello. You said: <span class="subst">&#123;Encoding.UTF8.GetString(buffer)&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> webSocket.SendAsync(<span class="keyword">new</span> ArraySegment&lt;<span class="built_in">byte</span>&gt;(serverMsg, <span class="number">0</span>, serverMsg.Length), result.MessageType, result.EndOfMessage, CancellationToken.None);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Message sent to Client&quot;</span>);</span><br><span class="line">        result = <span class="keyword">await</span> webSocket.ReceiveAsync(<span class="keyword">new</span> ArraySegment&lt;<span class="built_in">byte</span>&gt;(buffer), CancellationToken.None);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Message received from Client&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> webSocket.CloseAsync(result.CloseStatus.Value, result.CloseStatusDescription, CancellationToken.None);</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;WebSocket connection closed&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var socket = new WebSocket(&#x27;wss://localhost:6666/receive-message&#x27;);</span><br><span class="line">socket.send(&#x27;å‰ç«¯æ¶ˆæ¯&#x27;);</span><br></pre></td></tr></table></figure>

<h1 id="HTTP-ç½‘ç»œè¯·æ±‚"><a href="#HTTP-ç½‘ç»œè¯·æ±‚" class="headerlink" title="HTTP ç½‘ç»œè¯·æ±‚"></a>HTTP ç½‘ç»œè¯·æ±‚</h1><p>HttpWebRequestï¼šæœ€æ—©ï¼Œä¸é˜»å¡ uiï¼Œç»†èŠ‚æ§åˆ¶ï¼›<br>WebClientï¼šå¯¹ HttpWebRequest çš„ç®€åŒ–å’Œå°è£…ï¼›<br>HttpClientï¼š.NET 4.5 å¼€å§‹ï¼Œé¢„çƒ­æœºåˆ¶ï¼Œé€‚åˆå‘é€å¤šæ¬¡è¯·æ±‚ï¼›</p>
<h2 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> httpClientHandler = <span class="keyword">new</span> HttpClientHandler</span><br><span class="line">&#123;</span><br><span class="line">  Proxy = <span class="keyword">new</span> WebProxy(<span class="string">&quot;http://127.0.0.1:1080&quot;</span>, <span class="literal">false</span>),<span class="comment">// è®¾ç½®ä»£ç†</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> httpClient = <span class="keyword">new</span> HttpClient(httpClientHandler);</span><br><span class="line"><span class="keyword">var</span> response = <span class="keyword">await</span> httpClient.GetAsync(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> responseText = <span class="keyword">await</span> response.Content.ReadAsStringAsync();</span><br></pre></td></tr></table></figure>

<p>HttpClient å­˜åœ¨ Dispose åä¸èƒ½ç«‹å³é‡Šæ”¾å¯¹åº”å¥—æ¥å­—é—®é¢˜ï¼Œé»˜è®¤éœ€è¦ 4 åˆ†é’Ÿå»é‡Šæ”¾ã€‚<br>å¯ä»¥åˆ›å»ºä¸€ä¸ª HttpClient å®ä¾‹ï¼ŒæŠŠå®ƒå­˜å‚¨åœ¨ä¸€ä¸ªé™æ€å­—æ®µä¸­ï¼Œæˆ–è€…ä½¿ç”¨ HttpClientFactoryï¼Œ<a href="url=https://www.oschina.net/news/77036/httpclient">ç›¸å…³æ–‡ç« </a>ã€‚</p>

    </div>

    

    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/2023/02/14/CSharp-dispose/">CSharp dispose</a>
      
      
      <a class="next" rel="next" href="/2023/02/14/CSharp-dotnet-and-csharp/">CSharp .NET å’Œ C#</a>
      
    </section>
  </article>
</div>
    </div>
    <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© San Huo | <a href="https://hexo.io" target="_blank">Hexo</a> & <a
                    href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
  </div>
</body>

</html>